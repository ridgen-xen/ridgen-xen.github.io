<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–®–∞—Ö—Ç–µ—Ä Online</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .login-screen {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 50px;
            border-radius: 20px;
            text-align: center;
            min-width: 400px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
        }

        .login-screen h1 {
            font-size: 48px;
            color: white;
            margin-bottom: 10px;
        }

        .login-screen p {
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 20px;
        }

        .login-screen input {
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            border: 3px solid #ffd700;
            border-radius: 10px;
            font-size: 16px;
        }

        .login-screen button {
            width: 100%;
            padding: 16px;
            margin-top: 20px;
            background: #ffd700;
            border: none;
            border-radius: 10px;
            font-size: 20px;
            font-weight: bold;
            color: #333;
            cursor: pointer;
            transition: all 0.3s;
        }

        .login-screen button:hover {
            background: #ffed4e;
        }

        .login-screen button:active {
            transform: scale(0.98);
        }

        .error {
            color: #ff6b6b;
            margin-top: 15px;
            font-size: 14px;
            display: none;
        }

        .game-wrapper {
            display: none;
            width: 100%;
            max-width: 1400px;
            gap: 30px;
            padding: 20px;
        }

        .game-wrapper.show {
            display: flex;
        }

        .game-section {
            flex: 1;
        }

        .game-container {
            width: 100%;
            height: 500px;
            background: linear-gradient(to bottom, #87ceeb 0%, #e8d5c4 50%, #8b7355 100%);
            border: 5px solid #5d4037;
            position: relative;
            overflow: hidden;
            border-radius: 10px;
        }

        .soil {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 150px;
            background: linear-gradient(to bottom, #8b6f47 0%, #5d3a1a 100%);
        }

        #miner {
            position: absolute;
            bottom: 160px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 60px;
            z-index: 10;
        }

        .ore {
            position: absolute;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 35px;
            border: 3px solid;
        }

        .ore-gold {
            background: radial-gradient(circle at 30% 30%, #ffd700, #ffa500);
            border-color: #ff8c00;
        }

        .ore-silver {
            background: radial-gradient(circle at 30% 30%, #f0f0f0, #c0c0c0);
            border-color: #a8a8a8;
        }

        .ore-copper {
            background: radial-gradient(circle at 30% 30%, #dd7e50, #8b4513);
            border-color: #6b3410;
        }

        .ore-diamond {
            background: radial-gradient(circle at 30% 30%, #00ffff, #0088ff);
            border-color: #0055ff;
        }

        .ui {
            position: absolute;
            top: 15px;
            left: 15px;
            right: 15px;
            z-index: 20;
        }

        .info {
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 10px;
            color: white;
            margin-bottom: 10px;
            font-size: 18px;
            font-weight: bold;
        }

        .ore-counter {
            background: rgba(0, 0, 0, 0.7);
            padding: 10px 15px;
            border-radius: 10px;
            color: white;
            font-size: 14px;
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        #gameOver {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.95);
            color: white;
            padding: 40px;
            border-radius: 15px;
            text-align: center;
            display: none;
            z-index: 100;
            border: 3px solid #ffd700;
        }

        #gameOver h1 {
            font-size: 40px;
            color: #ffd700;
            margin-bottom: 20px;
        }

        #gameOver .results {
            background: rgba(100, 100, 100, 0.5);
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
            text-align: left;
        }

        #gameOver button {
            padding: 12px 25px;
            font-size: 16px;
            background: #ffd700;
            color: #333;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            margin-top: 10px;
            margin-right: 10px;
        }

        #gameOver button:hover {
            background: #ffed4e;
        }

        #gameOver button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .leaderboard-section {
            width: 300px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 15px;
            padding: 20px;
            color: white;
            max-height: 700px;
            overflow-y: auto;
        }

        .leaderboard-section h2 {
            color: #ffd700;
            text-align: center;
            margin-bottom: 20px;
        }

        .leaderboard-item {
            padding: 10px;
            margin-bottom: 10px;
            background: rgba(255, 215, 0, 0.1);
            border-left: 3px solid #ffd700;
            border-radius: 5px;
            font-size: 14px;
        }

        .leaderboard-item.current {
            background: rgba(0, 255, 150, 0.2);
            border-left-color: #00ff96;
        }

        .floating-text {
            position: absolute;
            font-weight: bold;
            pointer-events: none;
            animation: float-up 1s ease-out forwards;
        }

        @keyframes float-up {
            0% {
                opacity: 1;
                transform: translateY(0);
            }
            100% {
                opacity: 0;
                transform: translateY(-50px);
            }
        }
    </style>
</head>
<body>

<div class="login-screen" id="loginScreen">
    <h1>‚õèÔ∏è –®–ê–•–¢–ï–†</h1>
    <p>Online Edition</p>
    <input type="text" id="nameInput" placeholder="–í–≤–µ–¥–∏ —Å–≤–æ—ë –∏–º—è..." maxlength="20">
    <button id="playBtn">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
    <div class="error" id="errorMsg"></div>
</div>

<div class="game-wrapper" id="gameWrapper">
    <div class="game-section">
        <div class="game-container" id="gameContainer">
            <div class="soil"></div>
            <div id="miner">üßë‚Äçüè≠</div>
            
            <div class="ui">
                <div class="info">üë§ <span id="playerName"></span> | üí∞ <span id="score">0</span></div>
                <div class="ore-counter">
                    <div>üü® –ó–æ–ª–æ—Ç–æ: <span id="goldCount">0</span></div>
                    <div>‚ö™ –°–µ—Ä–µ–±—Ä–æ: <span id="silverCount">0</span></div>
                    <div>üü† –ú–µ–¥—å: <span id="copperCount">0</span></div>
                    <div>üíé –ê–ª–º–∞–∑—ã: <span id="diamondCount">0</span></div>
                </div>
            </div>

            <div id="gameOver">
                <h1>‚õèÔ∏è –ò–ì–†–ê –û–ö–û–ù–ß–ï–ù–ê!</h1>
                <div class="results">
                    <p>üí∞ –§–∏–Ω–∞–ª—å–Ω—ã–π —Å—á–µ—Ç: <span id="finalScore">0</span></p>
                    <p>üü® –ó–æ–ª–æ—Ç–æ: <span id="finalGold">0</span></p>
                    <p>‚ö™ –°–µ—Ä–µ–±—Ä–æ: <span id="finalSilver">0</span></p>
                    <p>üü† –ú–µ–¥—å: <span id="finalCopper">0</span></p>
                    <p>üíé –ê–ª–º–∞–∑—ã: <span id="finalDiamond">0</span></p>
                </div>
                <button onclick="location.reload()">üîÑ –ù–æ–≤–∞—è –∏–≥—Ä–∞</button>
                <button id="submitBtn" disabled>‚è≥ –û—Ç–ø—Ä–∞–≤–∫–∞...</button>
            </div>
        </div>
    </div>

    <div class="leaderboard-section">
        <h2>üèÜ –û–ë–õ–ê–ß–ù–´–ï –õ–ò–î–ï–†–´</h2>
        <div id="leaderboardList">‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞...</div>
        <button id="refreshBtn" style="width: 100%; padding: 10px; margin-top: 15px; background: #ffd700; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; color: #333;">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js"></script>
<script>
// === FIREBASE –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ===
const firebaseConfig = {
    apiKey: "AIzaSyDlZ8YW0J8qKmx5N9pQ4R3S2T1U0V9W8X7Y",
    authDomain: "miner-game-ridgen.firebaseapp.com",
    projectId: "miner-game-ridgen",
    storageBucket: "miner-game-ridgen.appspot.com",
    messagingSenderId: "123456789012",
    databaseURL: "https://miner-game-ridgen-default-rtdb.firebaseio.com",
    appId: "1:123456789012:web:abcdef1234567890"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const leaderboardRef = db.ref('leaderboard');

let playerName = '';
let score = 0;
let gameActive = false;
let oreCount = { gold: 0, silver: 0, copper: 0, diamond: 0 };
let mouseX = 0;
let difficulty = 1;
let oresCreated = 0;

const badWords = ['–±–ª—è–¥—å', '–µ–±–∞—Ç—å', '—Ö—É–π', '—Å—É–∫–∞', '–ø–∏–∑–¥–∞', '—á–µ—Ä—Ç', '–¥–µ—Ä—å–º–æ', '–≥–∞–≤–Ω–æ'];

function hasBadWords(text) {
    const lower = text.toLowerCase();
    return badWords.some(word => lower.includes(word));
}

// === –ö–ù–û–ü–ö–ê –°–¢–ê–†–¢ ===
document.getElementById('playBtn').addEventListener('click', function() {
    const input = document.getElementById('nameInput').value.trim();
    
    if (!input) {
        showError('–í–≤–µ–¥–∏ –∏–º—è!');
        return;
    }
    
    if (input.length < 2) {
        showError('–ò–º—è –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –º–∏–Ω–∏–º—É–º 2 —Å–∏–º–≤–æ–ª–∞!');
        return;
    }
    
    if (hasBadWords(input)) {
        showError('–ò—Å–ø–æ–ª—å–∑—É–π –ø—Ä–∏–ª–∏—á–Ω–æ–µ –∏–º—è!');
        return;
    }
    
    playerName = input;
    document.getElementById('playerName').textContent = playerName;
    document.getElementById('loginScreen').style.display = 'none';
    document.getElementById('gameWrapper').classList.add('show');
    
    loadLeaderboard();
    startGameLoop();
});

function showError(msg) {
    const err = document.getElementById('errorMsg');
    err.textContent = msg;
    err.style.display = 'block';
    setTimeout(() => err.style.display = 'none', 3000);
}

// === –ó–ê–ì–†–£–ó–ö–ê –¢–ê–ë–õ–ò–¶–´ –ò–ó FIREBASE ===
async function loadLeaderboard() {
    try {
        leaderboardRef.once('value', (snapshot) => {
            const data = snapshot.val();
            const leaderboard = data ? Object.values(data) : [];
            displayLeaderboard(leaderboard);
        });
    } catch (e) {
        console.error('–û—à–∏–±–∫–∞:', e);
        document.getElementById('leaderboardList').innerHTML = '<p style="color: #ff6b6b;">‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</p>';
    }
}

// === –ü–û–ö–ê–ó –¢–ê–ë–õ–ò–¶–´ –õ–ò–î–ï–†–û–í ===
function displayLeaderboard(leaderboard) {
    const list = document.getElementById('leaderboardList');
    list.innerHTML = '';
    
    if (!leaderboard.length) {
        list.innerHTML = '<p style="color: #ffd700; text-align: center;">–ü–æ–∫–∞ –ø—É—Å—Ç–æ üì≠</p>';
        return;
    }
    
    leaderboard.sort((a, b) => b.score - a.score).slice(0, 15).forEach((entry, i) => {
        const div = document.createElement('div');
        div.className = 'leaderboard-item';
        if (entry.name === playerName) div.classList.add('current');
        const medal = ['ü•á', 'ü•à', 'ü•â'][i] || `${i+1}.`;
        div.innerHTML = `<strong>${medal}</strong> ${entry.name} - üí∞ ${entry.score}`;
        list.appendChild(div);
    });
}

document.getElementById('refreshBtn').addEventListener('click', loadLeaderboard);

// === –û–¢–ü–†–ê–í–ö–ê –†–ï–ó–£–õ–¨–¢–ê–¢–ê –í FIREBASE ===
async function submitScore() {
    if (score === 0) {
        alert('–°—á–µ—Ç –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å 0!');
        return;
    }
    
    const submitBtn = document.getElementById('submitBtn');
    submitBtn.disabled = true;
    submitBtn.textContent = '‚è≥ –û—Ç–ø—Ä–∞–≤–ª—è—é...';
    
    try {
        // –°–æ–∑–¥–∞—ë–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –¥–ª—è –∑–∞–ø–∏—Å–∏
        const entryKey = playerName.replace(/[^a-z0-9]/gi, '');
        
        leaderboardRef.child(entryKey).set({
            name: playerName,
            score: score,
            timestamp: new Date().toISOString()
        }).then(() => {
            submitBtn.disabled = false;
            submitBtn.textContent = '‚úÖ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!';
            submitBtn.style.background = '#00ff96';
            alert('üéâ –†–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞–≥—Ä—É–∂–µ–Ω –≤ –æ–±–ª–∞–∫–æ!\n–¢–µ–±—è –≤–∏–¥–Ω–æ –Ω–∞ —Ç–∞–±–ª–∏—Ü–µ –ª–∏–¥–µ—Ä–æ–≤!');
            loadLeaderboard();
        }).catch((error) => {
            throw error;
        });
    } catch (e) {
        console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏:', e);
        submitBtn.disabled = false;
        submitBtn.textContent = '‚ùå –û—à–∏–±–∫–∞!';
        submitBtn.style.background = '#ff6b6b';
        alert('‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç:\n' + e.message);
    }
}

document.getElementById('submitBtn').addEventListener('click', submitScore);

// === –ò–ì–†–û–í–ê–Ø –õ–û–ì–ò–ö–ê ===
const gameContainer = document.getElementById('gameContainer');
const miner = document.getElementById('miner');

document.addEventListener('mousemove', (e) => {
    if (gameActive) {
        const rect = gameContainer.getBoundingClientRect();
        mouseX = e.clientX - rect.left - 30;
        mouseX = Math.max(0, Math.min(mouseX, rect.width - 60));
        miner.style.left = mouseX + 'px';
    }
});

function createOre() {
    if (!gameActive) return;
    
    const oreTypes = ['gold', 'silver', 'copper', 'diamond'];
    const weights = [40, 30, 25, 5];
    let random = Math.random() * 100;
    let type = 'gold';
    let w = 0;
    
    for (let i = 0; i < oreTypes.length; i++) {
        w += weights[i];
        if (random < w) {
            type = oreTypes[i];
            break;
        }
    }
    
    const ore = document.createElement('div');
    ore.className = `ore ore-${type}`;
    const emojis = { gold: 'üü®', silver: '‚ö™', copper: 'üü†', diamond: 'üíé' };
    ore.textContent = emojis[type];
    
    const startX = Math.random() * (gameContainer.offsetWidth - 50);
    ore.style.left = startX + 'px';
    ore.style.top = '-60px';
    gameContainer.appendChild(ore);
    
    let oreY = -60;
    const speed = 3 + difficulty * 0.5;
    
    const interval = setInterval(() => {
        oreY += speed;
        ore.style.top = oreY + 'px';
        
        if (checkCollision(startX, oreY, mouseX)) {
            clearInterval(interval);
            ore.remove();
            mineOre(type);
        }
        
        if (oreY > gameContainer.offsetHeight) {
            clearInterval(interval);
            ore.remove();
            endGame();
        }
    }, 30);
    
    oresCreated++;
    difficulty = Math.floor(oresCreated / 20) + 1;
    
    if (gameActive) {
        setTimeout(createOre, Math.max(500, 1500 - difficulty * 100));
    }
}

function checkCollision(oreX, oreY, minerX) {
    return oreX > minerX - 40 && oreX < minerX + 60 && oreY > gameContainer.offsetHeight - 200;
}

function mineOre(type) {
    const values = { gold: 50, silver: 30, copper: 20, diamond: 100 };
    score += values[type];
    oreCount[type]++;
    
    document.getElementById('score').textContent = score;
    document.getElementById(`${type}Count`).textContent = oreCount[type];
    
    const floatText = document.createElement('div');
    floatText.className = 'floating-text';
    floatText.textContent = `+${values[type]}`;
    floatText.style.left = mouseX + 'px';
    floatText.style.top = (gameContainer.offsetHeight - 250) + 'px';
    const colors = { gold: '#ffd700', silver: '#e8e8e8', copper: '#ff8c00', diamond: '#00d9ff' };
    floatText.style.color = colors[type];
    gameContainer.appendChild(floatText);
    setTimeout(() => floatText.remove(), 1000);
}

function endGame() {
    gameActive = false;
    document.getElementById('gameOver').style.display = 'block';
    document.getElementById('finalScore').textContent = score;
    document.getElementById('finalGold').textContent = oreCount.gold;
    document.getElementById('finalSilver').textContent = oreCount.silver;
    document.getElementById('finalCopper').textContent = oreCount.copper;
    document.getElementById('finalDiamond').textContent = oreCount.diamond;
    
    const submitBtn = document.getElementById('submitBtn');
    submitBtn.disabled = false;
    submitBtn.textContent = 'üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ –æ–±–ª–∞–∫–æ';
    submitBtn.style.background = '#ffd700';
}

function startGameLoop() {
    gameActive = true;
    score = 0;
    oreCount = { gold: 0, silver: 0, copper: 0, diamond: 0 };
    difficulty = 1;
    oresCreated = 0;
    
    document.getElementById('score').textContent = '0';
    document.getElementById('goldCount').textContent = '0';
    document.getElementById('silverCount').textContent = '0';
    document.getElementById('copperCount').textContent = '0';
    document.getElementById('diamondCount').textContent = '0';
    document.getElementById('gameOver').style.display = 'none';
    
    createOre();
}

document.getElementById('nameInput').addEventListener('keypress', (e) => {
    if (e.key === 'Enter') document.getElementById('playBtn').click();
});
</script>

</body>
</html>
