<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>–®–∞—Ö—Ç–µ—Ä Online</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      background: #f0f0f0;
      margin: 0;
      padding: 20px;
      color: #333;
    }
    .game-area {
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      max-width: 600px;
      margin: 0 auto;
    }
    button {
      padding: 10px 20px;
      margin: 5px;
      font-size: 16px;
      cursor: pointer;
      border: none;
      background: #4CAF50;
      color: white;
      border-radius: 5px;
    }
    button:hover {
      background: #45a049;
    }
    #leaderboard ol {
      text-align: left;
      max-width: 300px;
      margin: 10px auto;
      list-style-type: decimal;
    }
    .hidden { display: none; }
    h1 { margin-top: 0; }
  </style>
</head>
<body>

<div class="game-area">
  <h1>‚õèÔ∏è –®–ê–•–¢–ï–†</h1>
  <p><strong>Online Edition</strong></p>

  <!-- –≠–∫—Ä–∞–Ω –∏–≥—Ä—ã -->
  <div id="screen-game">
    <p>–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</p>
    <button id="btn-start">üßë‚Äçüè≠ –ù–∞—á–∞—Ç—å</button>
    <p id="stats" class="hidden">
      üë§ –ò–º—è: <span id="player-name">‚Äî</span> | üí∞ <span id="score">0</span><br>
      üü® –ó–æ–ª–æ—Ç–æ: <span id="gold">0</span> |
      ‚ö™ –°–µ—Ä–µ–±—Ä–æ: <span id="silver">0</span> |
      üü† –ú–µ–¥—å: <span id="copper">0</span> |
      üíé –ê–ª–º–∞–∑—ã: <span id="diamonds">0</span>
    </p>
  </div>

  <!-- –≠–∫—Ä–∞–Ω –æ–∫–æ–Ω—á–∞–Ω–∏—è -->
  <div id="screen-end" class="hidden">
    <h2>‚õèÔ∏è –ò–ì–†–ê –û–ö–û–ù–ß–ï–ù–ê!</h2>
    <p>üí∞ –§–∏–Ω–∞–ª—å–Ω—ã–π —Å—á–µ—Ç: <span id="final-score">0</span></p>
    <p>üü® –ó–æ–ª–æ—Ç–æ: <span id="final-gold">0</span></p>
    <p>‚ö™ –°–µ—Ä–µ–±—Ä–æ: <span id="final-silver">0</span></p>
    <p>üü† –ú–µ–¥—å: <span id="final-copper">0</span></p>
    <p>üíé –ê–ª–º–∞–∑—ã: <span id="final-diamonds">0</span></p>
    <button id="btn-submit">üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç</button>
    <button id="btn-restart-end">üîÑ –ù–æ–≤–∞—è –∏–≥—Ä–∞</button>
    <p id="submit-status" class="hidden">‚è≥ –û—Ç–ø—Ä–∞–≤–∫–∞...</p>
  </div>

  <!-- –¢–∞–±–ª–∏—Ü–∞ –ª–∏–¥–µ—Ä–æ–≤ -->
  <div id="leaderboard-section">
    <h3>üèÜ –û–ë–õ–ê–ß–ù–´–ï –õ–ò–î–ï–†–´</h3>
    <div id="leaderboard">‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞...</div>
    <button id="btn-refresh">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
  </div>
</div>

<script>
  // === –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø ===
  const API_URL = 'http://104.128.135.170:3000/api';

  // –°–æ—Å—Ç–æ—è–Ω–∏–µ
  let gameState = {
    score: 0,
    gold: 0,
    silver: 0,
    copper: 0,
    diamonds: 0,
    name: ''
  };

  // DOM
  const screenGame = document.getElementById('screen-game');
  const screenEnd = document.getElementById('screen-end');
  const statsEl = document.getElementById('stats');
  const btnStart = document.getElementById('btn-start');
  const btnSubmit = document.getElementById('btn-submit');
  const btnRestartEnd = document.getElementById('btn-restart-end');
  const btnRefresh = document.getElementById('btn-refresh');

  // –§–∏–Ω–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
  const finalScoreEl = document.getElementById('final-score');
  const finalGoldEl = document.getElementById('final-gold');
  const finalSilverEl = document.getElementById('final-silver');
  const finalCopperEl = document.getElementById('final-copper');
  const finalDiamondsEl = document.getElementById('final-diamonds');
  const submitStatusEl = document.getElementById('submit-status');

  // === –§–£–ù–ö–¶–ò–ò ===
  function updateStats() {
    document.getElementById('score').textContent = gameState.score;
    document.getElementById('gold').textContent = gameState.gold;
    document.getElementById('silver').textContent = gameState.silver;
    document.getElementById('copper').textContent = gameState.copper;
    document.getElementById('diamonds').textContent = gameState.diamonds;
    document.getElementById('player-name').textContent = gameState.name || '‚Äî';
  }

  async function loadLeaders() {
    try {
      const res = await fetch(API_URL + '/leaders');
      if (!res.ok) throw new Error('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏');
      const leaders = await res.json();
      const leaderboardEl = document.getElementById('leaderboard');
      if (leaders.length === 0) {
        leaderboardEl.innerHTML = '<p>–µ—â—ë –Ω–µ—Ç –ª–∏–¥–µ—Ä–æ–≤</p>';
      } else {
        let html = '<ol>';
        leaders.forEach(p => {
          html += `<li>${p.name} ‚Äî ${p.score} –æ—á–∫–æ–≤</li>`;
        });
        html += '</ol>';
        leaderboardEl.innerHTML = html;
      }
    } catch (err) {
      document.getElementById('leaderboard').innerHTML = '<p style="color:red">‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å</p>';
    }
  }

  async function submitResult() {
    submitStatusEl.classList.remove('hidden');
    try {
      const res = await fetch(API_URL + '/submit', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          name: gameState.name,
          score: gameState.score,
          gold: gameState.gold,
          silver: gameState.silver,
          copper: gameState.copper,
          diamonds: gameState.diamonds
        })
      });
      const data = await res.json();
      if (data.success) {
        submitStatusEl.textContent = '‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ!';
        loadLeaders(); // –æ–±–Ω–æ–≤–∏—Ç—å –ª–∏–¥–µ—Ä–æ–≤
      } else {
        submitStatusEl.textContent = '‚ùå –û—à–∏–±–∫–∞: ' + (data.error || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ');
      }
    } catch (err) {
      submitStatusEl.textContent = 'üö´ –ù–µ—Ç —Å–≤—è–∑–∏ —Å —Å–µ—Ä–≤–µ—Ä–æ–º';
    }
  }

  // === –ò–ú–ò–¢–ê–¶–ò–Ø –ò–ì–†–´ (–∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à—É –ª–æ–≥–∏–∫—É) ===
  function simulateGame() {
    // –ó–¥–µ—Å—å –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤–∞—à–∞ —Ä–µ–∞–ª—å–Ω–∞—è –∏–≥—Ä–æ–≤–∞—è –ª–æ–≥–∏–∫–∞
    // –ü–æ–∫–∞ ‚Äî –ø—Ä–æ—Å—Ç–∞—è —Å–∏–º—É–ª—è—Ü–∏—è
    gameState.score = Math.floor(Math.random() * 1000) + 50;
    gameState.gold = Math.floor(Math.random() * 20);
    gameState.silver = Math.floor(Math.random() * 30);
    gameState.copper = Math.floor(Math.random() * 50);
    gameState.diamonds = Math.floor(Math.random() * 5);

    // –ü–æ–∫–∞–∑–∞—Ç—å —Ñ–∏–Ω–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
    finalScoreEl.textContent = gameState.score;
    finalGoldEl.textContent = gameState.gold;
    finalSilverEl.textContent = gameState.silver;
    finalCopperEl.textContent = gameState.copper;
    finalDiamondsEl.textContent = gameState.diamonds;

    // –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —ç–∫—Ä–∞–Ω
    screenGame.classList.add('hidden');
    screenEnd.classList.remove('hidden');
  }

  // === –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò ===
  btnStart.onclick = () => {
    const name = prompt('–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è (–¥–æ 20 —Å–∏–º–≤–æ–ª–æ–≤):');
    if (!name || name.trim() === '') return alert('–ò–º—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ!');
    if (name.length > 20) return alert('–°–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω–æ–µ –∏–º—è!');
    gameState.name = name.trim();
    statsEl.classList.remove('hidden');
    updateStats();
    setTimeout(simulateGame, 1000); // –∏–º–∏—Ç–∞—Ü–∏—è –∏–≥—Ä—ã
  };

  btnSubmit.onclick = () => {
    if (!gameState.name) return alert('–°–Ω–∞—á–∞–ª–∞ –Ω–∞—á–Ω–∏—Ç–µ –∏–≥—Ä—É!');
    submitResult();
  };

  btnRestartEnd.onclick = () => {
    screenEnd.classList.add('hidden');
    screenGame.classList.remove('hidden');
    gameState = { score: 0, gold: 0, silver: 0, copper: 0, diamonds: 0, name: '' };
    statsEl.classList.add('hidden');
  };

  btnRefresh.onclick = loadLeaders;

  // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
  loadLeaders();
</script>

</body>
</html>
